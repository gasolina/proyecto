#include <iostream>
#include<conio.h>
#include<stdlib.h>
#include <stdio.h>
#include<string.h>
#include<iomanip>
using namespace std;
#define fil 50
//estructuras
struct venta{
	int idventa;
	char fecha[10];
	int idprod;
	float cantidad;
	float preciototal;
	int idbomba;
	int idauto;
	char estado;
};
struct automotor{
	int idauto;
	char placa[10];
	int idcliente;
	char estado;
};
struct cliente{
int idcliente;
char nombre[30];
char email[30];
char telefono[12];
char nit[10];
char estado;
};
struct vendedor{
int idvendedor;
char nombre[30];
char email[30];
char telefono[12];
char estado;
};
struct producto{
int idprod;
char nombre[30];
float preciounit;
float stock;
char estado;
};
struct compras{
int idcompra;
char fecha[10];
int idprod;
float cantidad;
float preciototal;
char estado;
};
struct bomba{
int idbomba;
char descripcion[30];
int idprod;
int idvendedor;
char estado;
};
struct fechas{
int dia;
int mes;
int anho;
}; //contiene cmapos dia mes y anho
//funciones
bool validarplaca(char placa[]);//listo
int buscaridplaca(char placa[]);//listo
int generarid(int tipo);//listo
void fecha(char fecha[10] );//listo
bool menuventas(venta &v);//llena el preciototal,idprod,idbomba,cantidad//listo
void anhadirventa(venta v);//listo
void barrafecha(char fecha[10]);//listo
int validarentero();//listo
float validarfloat();//listo(revisar por si hubiera mas de un punto)
vendedor buscarvendedorporidvendedor(int id);//listo
producto buscarproducto(int id);//listo
bool existenciavendedor();//listo
bool menucompras(compras &c);//listo
void anhadircompra(compras c);//listo
bool existenciaproducto();//listo
void rankingclientes();//listo
void convertirfecha(fechas &f,char fecha[10]);//listo ,convierte el char fecha a la estructura fechas para poder comparar
bool existenciacliente();//listo
int calcularventasporcliente(int id,fechas f1,fechas f2);//listo
void ordenarmatriz(int mat[fil][2],int n);//listo
void buscarnombrecliente(int id,char nombre[30]);//listo
int compararfechas(fechas f1,fechas f2);//listo
bool existenciaventas();//listo
 void quitarbarrasfecha(char fecha[10]);//listo
vendedor buscarvendedorporidbomba(int id);//listo
automotor buscarautomotorporidauto(int id);//listo
bomba obtidbomba(int x);//listo
cliente obtidcliente(int x);//listo
vendedor obtidvendedor(int x);//listo
bool existenciaautomotor();//listo
bool existenciabomba();//listo
bool existenciacompra();//listo
cliente buscarclienteporidauto(int idauto);//listo
bool validaremail(char e[80]);//listo
bool validarnombre(char nombre[30]);//listo
bool validartelefono(char telefono[12]);//listo
bool validarnit(char ni[10]);//listo
int menuclientes();//listo
int menuautomotor();//listo
int menubomba();//listo
int menuvendedor();//listo
int menuproducto();//listo
int calcularventasporbomba(int idbomba,fechas f1,fechas f2);//listo
void eliminarautomotoresporcliente(int x);//listo



//desarrollo
void vender()//falta verificar que las fechas ingresadas sean mayores alas anteriores lo mismo falta para compra
{venta v,vaux;char placa[12];int op;bool z;fechas f1,f2;
   do{op=1;
        do{ cout<<"\ningrese placa";
			fflush(stdin);
			gets(placa);}while(validarplaca(placa)==false);
			v.idauto=buscaridplaca(placa);
			if(v.idauto>0)
			{
				v.idventa=generarid(7);
				fecha(v.fecha);
				convertirfecha(f1,v.fecha);
				FILE*ptr=fopen("Ventas.dat","rb");
				fseek(ptr,-sizeof(v),SEEK_END);
				fread(&vaux,sizeof(v),1,ptr);
				fclose(ptr);
				convertirfecha(f2,vaux.fecha);

				if(compararfechas(f2,f1)==1||compararfechas(f2,f1)==0)
						{barrafecha(v.fecha);
						z=menuventas(v);
						if(z==true)
						{ 
							cout<<"\n esta seguro de sus datos?";
							do{cout<"\n1.-si\n2.-vovler a intentar";
							cin>>op;}while(op!=1&&op!=2);
							if(op==1)
							{anhadirventa(v);cout<<"\nventa registrada";getch();}
						}
						else{
							do{cout<<"\nquiere volver a intentarlo?";
								cout<<"\n1.-NO\n2.-SI";
								cin>>op;}while(op!=1&&op!=2);
							}
					    }
				else{
				cout<<"\n fecha incorrecta muy antigua";
				getch();
				op=2;
				}
			}
			
			else{
			cout<<"\n placa no registrada, vaya a registrarlo";
			do{cout<<"\n1.-volver a menu\n2.-volver a intentar";
			cin>>op;}while(op!=1&&op!=2);
			}
			
   }while(op==2);
   
}
void comprar()
	{compras c,caux;bool z;int op;fechas f1,f2;
do{       op=1; 
	fecha(c.fecha);
	convertirfecha(f1,c.fecha);
				FILE*ptr=fopen("Cliente.dat","rb");
				fseek(ptr,-sizeof(c),SEEK_END);
				fread(&caux,sizeof(c),1,ptr);
				fclose(ptr);
				convertirfecha(f2,caux.fecha);

if(compararfechas(f2,f1)==1||compararfechas(f2,f1)==0)
	{
			barrafecha(c.fecha);

			c.idcompra=generarid(6);
			z=menucompras(c);
			if(z==true)
			{
				cout<<"\n esta seguro de sus datos?";
							do{cout<"\n1.-si\n2.-vovler a intentar";
							cin>>op;}while(op!=1&&op!=2);
							if(op==1)
							{anhadircompra(c);cout<<"\ncompra registrada";getch();}
			}
			else{   
						do{cout<<"\nquiere volver a intentarlo?";
							cout<<"\n1.-volver a menu \n2.-SI";
							cin>>op;}while(op!=1&&op!=2);
				}
	}
else{
	cout<<"\n la fecha esta mal";getch();
op=2;
}
}while(op==2);
}
//reportes por tiempo
void rankingclientes()
{char fecha1[10],fecha2[10];cliente c;int mat[fil][2],n=0;char nombre[30];
  fechas f1,f2,aux;
	cout<<"\ningrese fecha 1";
	fecha(fecha1);
	cout<<"\ningrese fecha 2";
	fecha(fecha2);
	convertirfecha(f1,fecha1);
	convertirfecha(f2,fecha2);
	if(compararfechas(f1,f2)==-1)//asegurarse que f1 es menor a f2
	{
        aux=f1;
		f1=f2;
		f2=aux;
	}
	FILE *ptr=fopen("Cliente.dat","rb");
	if(ptr!=NULL&&existenciacliente()==true)
	{  fread(&c,sizeof(c),1,ptr);
       while(feof(ptr)==false)
	   {  if(c.estado=='S')
	        {
				mat[n][0]=c.idcliente;
           mat[n][1]=calcularventasporcliente(c.idcliente,f1,f2);
		   n++;
	        }
	      fread(&c,sizeof(c),1,ptr);
	   }
		   fclose(ptr);

		   ordenarmatriz(mat,n);
		cout<<endl<<"---------TOP CLIENTES---------"<<endl;
		cout<<"CLIENTE";
			cout.width(20);
			cout<<"COMPRAS TOTALES"<<endl;
		for( int i =0;i<n;i++)
		{
			buscarnombrecliente(mat[i][0],nombre);//busca nombre del cliente y lo guarda en char nombre
			cout<<nombre;
			cout.width(20);
			cout<<mat[i][1]<<endl;
	       getch();
		}
	}
	else
	{
		cout<<"\n no existe clientes registrados";
		getch();fclose(ptr);
	}
	
}
void rankingbomba()
{
	char fecha1[10],fecha2[10];int mat[fil][2],n=0;vendedor ven;
  fechas f1,f2,aux;bomba b;
	cout<<"\ningrese fecha 1";
	fecha(fecha1);
	cout<<"\ningrese fecha 2";
	fecha(fecha2);
	convertirfecha(f1,fecha1);
	convertirfecha(f2,fecha2);
	if(compararfechas(f1,f2)==-1)//asegurarse que f1 es menor a f2
	{
        aux=f1;
		f1=f2;
		f2=aux;
	}
		FILE *ptr=fopen("Bomba.dat","rb");
	if(ptr!=NULL&&existenciacliente()==true)
	{  fread(&b,sizeof(b),1,ptr);
       while(feof(ptr)==false)
	   {  if(b.estado=='S')
	        {
				mat[n][0]=b.idvendedor;
				mat[n][1]=calcularventasporbomba(b.idbomba,f1,f2);
		   n++;
	        }
	      fread(&b,sizeof(b),1,ptr);
	   }
		   fclose(ptr);

		   ordenarmatriz(mat,n);
		cout<<endl<<"---------TOP VENDEDORES---------"<<endl;
		cout<<"VENDEDOR";
			cout.width(20);
			cout<<"VENTAS TOTALES"<<endl;
		for( int i =0;i<n;i++)
		{
			ven=buscarvendedorporidvendedor(mat[i][0]);//busca nombre del cliente y lo guarda en char nombre
			cout<<ven.nombre;
			cout.width(20);
			cout<<mat[i][1]<<endl;
	       getch();
		}
	}
	else
	{
		cout<<"\n no existe clientes registrados";
		getch();fclose(ptr);
	}

}
void reporteporfechaventas()
{char fecha1[10],fecha2[10];venta v;char fechaaux[10],nombrecliente[30];vendedor ven;automotor a;producto p;
	fechas f1,f2,f3;
	cout<<"\ningrese fecha 1";
	fecha(fecha1);
	cout<<"\ningrese fecha 2";
	fecha(fecha2);
	convertirfecha(f1,fecha1);
	convertirfecha(f2,fecha2);
	FILE *ptr1=fopen("Ventas.dat","rb");
	if(ptr1!=NULL&&existenciaventas()==true)
	{
		fread(&v,sizeof(v),1,ptr1);
		cout<<"--------REPORTE VENTAS---------";
		cout<<endl;
		cout<<"nro";
		cout.width(20);
		cout<<"fecha";
		cout.width(20);
		cout<<"producto";
		cout.width(20);
		cout<<"cantidad";
		cout.width(20);
		cout<<"precio total";
		cout.width(20);
		cout<<"vendedor";
		cout.width(20);
		cout<<"cliente";
			cout.width(20);
		cout<<"placa";
		cout<<endl;
		fread(&v,sizeof(v),1,ptr1);
         while(feof(ptr1)==false)
		 {
			 if(v.estado=='S')
			 {
				 strcpy(fechaaux,v.fecha);
				 quitarbarrasfecha(fechaaux);
				 convertirfecha(f3,fechaaux);
				if(((compararfechas(f1,f3)==0)||(compararfechas(f1,f3)==1))&&((compararfechas(f3,f2)==0)||(compararfechas(f3,f2)==1)))
				{
					ven=buscarvendedorporidbomba(v.idbomba);
					a=buscarautomotorporidauto(v.idauto);
					p=buscarproducto(v.idprod);
					buscarnombrecliente(a.idcliente,nombrecliente);
					cout<<v.idventa;
						cout.width(20);
						cout<<v.fecha;
						cout.width(20);
						cout<<p.nombre;
						cout.width(20);
						cout<<v.cantidad;
						cout.width(20);
						cout<<v.preciototal;
						cout.width(20);
						cout<<ven.nombre;
						cout.width(20);
						cout<<nombrecliente;
							cout.width(20);
							cout<<a.placa;
						cout<<endl;
				}
				
			 }

	 fread(&v,sizeof(v),1,ptr1);
		 }
	
		 fclose(ptr1);

	}
	else
	{fclose(ptr1);
		cout<<"no existen ventas registradas";getch();

	}
}
void reporteporfechacompras()
{
	char fecha1[10],fecha2[10];compras c;char fechaaux[10],nombrecliente[30];producto p;
	fechas f1,f2,f3;
		cout<<"\ningrese fecha 1";
	fecha(fecha1);
	cout<<"\ningrese fecha 2";
	fecha(fecha2);
	convertirfecha(f1,fecha1);
	convertirfecha(f2,fecha2);
	if(compararfechas(f1,f2)==-1)//asegurarse que f1 es menor a f2
	{
        f3=f1;
		f1=f2;
		f2=f3;
	}
	FILE *ptr1=fopen("Compras.dat","rb");
	if(ptr1!=NULL&&existenciaventas()==true)
	{
		fread(&c,sizeof(c),1,ptr1);
		cout<<"--------REPORTE COMPRAS---------";
		cout<<endl;
		cout<<"nro";
		cout.width(20);
		cout<<"fecha";
		cout.width(20);
		cout<<"producto";
		cout.width(20);
		cout<<"cantidad";
		cout.width(20);
		cout<<"precio total";
		cout<<endl;
		fread(&c,sizeof(c),1,ptr1);
         while(feof(ptr1)==false)
		 {
			 if(c.estado=='S')
			 {
				 strcpy(fechaaux,c.fecha);
				 quitarbarrasfecha(fechaaux);
				 convertirfecha(f3,fechaaux);
				if(((compararfechas(f1,f3)==0)||(compararfechas(f1,f3)==1))&&((compararfechas(f3,f2)==0)||(compararfechas(f3,f2)==1)))
				{
					
					
					p=buscarproducto(c.idprod);
					
					 cout<<c.idcompra;
						cout.width(20);
						cout<<c.fecha;
						cout.width(20);
						cout<<p.nombre;
						cout.width(20);
						cout<<c.cantidad;
						cout.width(20);
						cout<<c.preciototal;
						cout<<endl;
				}
			 }
			 fread(&c,sizeof(c),1,ptr1);
		 }
		 fclose(ptr1);

	}
	else
	{fclose(ptr1);
		cout<<"no existen compras registradas";getch();

	}
}
//reportes generales
void reportevendedorgenerales()

{FILE *ptr;
vendedor ven;
bomba b;
ptr=fopen("Vendedor.dat","rb");
if(ptr!=NULL&&existenciavendedor()==true)
		{fread(&ven,sizeof(ven),1,ptr);
		cout<<setw(15)<<"VENDEDOR"<<setw(30)<<"EMAIL"<<setw(15)<<"TELEFONO"<<setw(15)<<"BOMBA"<<endl;
		 while(feof(ptr)==false)
		 {  if(ven.estado=='S')
		    {	b=obtidbomba(ven.idvendedor);
				cout<<setw(15)<<ven.nombre<<setw(30)<<ven.email<<setw(15)<<ven.telefono<<setw(15)<<b.idbomba<<endl;
		     }
		  fread(&ven,sizeof(ven),1,ptr);
		 }
	
		fclose(ptr);}
		else
		{cout<<"No existen vendedores registrados";
		fclose(ptr);}

}
void reporteclientesgenerales()

{FILE *ptr;
cliente c;

ptr=fopen("Cliente.dat","rb");
if(ptr!=NULL&&existenciacliente()==true)
		{fread(&c,sizeof(c),1,ptr);
		cout<<setw(15)<<"CLIENTE"<<setw(30)<<"EMAIL"<<setw(15)<<"TELEFONO"<<setw(15)<<"NIT"<<endl;
		 while(feof(ptr)==false)
		 {  if(c.estado=='S')
		    {
				cout<<setw(15)<<c.nombre<<setw(30)<<c.email<<setw(15)<<c.telefono<<setw(15)<<c.nit<<endl;
		     }
		  fread(&c,sizeof(c),1,ptr);
		 }
	
		}
		else
		{cout<<"No existen clientes registrados";
		}
		fclose(ptr);
}
void reporteproductosgenerales()
{FILE *ptr;
producto p;
ptr=fopen("Producto.dat","rb");
if(ptr!=NULL&&existenciaproducto()==true)
		{fread(&p,sizeof(p),1,ptr);
		cout<<setw(20)<<"NOMBRE DEL PRODUCTO"<<setw(15)<<"PRECIO UNITARIO"<<setw(15)<<"STOCK"<<endl;
		 while(feof(ptr)==false)
		 {  if(p.estado=='S')
		    {
				cout<<setw(20)<<p.nombre<<setw(15)<<p.preciounit<<setw(15)<<p.stock<<endl;
		     }
		  fread(&p,sizeof(p),1,ptr);
		 }
	
		}
		else
		{cout<<"No existen productos registrados";
		}fclose(ptr);

}
void reporteautomotorgenerales()
	{FILE *ptr;
automotor a;
cliente c;
ptr=fopen("Automotor.dat","rb");
		if(ptr!=NULL&&existenciaautomotor()==true)
		{fread(&a,sizeof(a),1,ptr);
		cout<<setw(20)<<"PLACA"<<setw(20)<<"CLIENTE DUENHO"<<endl;
		 while(feof(ptr)==false)
		 {  if(a.estado=='S')
		    {
				c=obtidcliente(a.idcliente);
				cout<<setw(20)<<a.placa<<setw(20)<<c.nombre<<endl;
		     }
		  fread(&a,sizeof(a),1,ptr);
		 }
	
		}
		else
		{cout<<"No existen automotores registrados";
		}
		fclose(ptr);
}
void reportebombagenerales()
	{FILE *ptr;
bomba b;
vendedor ven;
ptr=fopen("Bomba.dat","rb");
		if(ptr!=NULL&&existenciabomba()==true)
		{fread(&b,sizeof(b),1,ptr);
		cout<<setw(20)<<"NOMBRE DEL PRODUCTO"<<setw(20)<<"NOMBRE DEL VENDEDOR"<<endl;
		 while(feof(ptr)==false)
		 {  if(b.estado=='S')
		    {
				ven=obtidvendedor(b.idvendedor);
				cout<<setw(20)<<b.descripcion<<setw(20)<<ven.nombre<<endl;
		     }
		  fread(&b,sizeof(b),1,ptr);
		 }
	          
		}
		else
		{cout<<"No existen bombas registrados";
		}
			fclose(ptr);

}
void reportecompragenerales()
{FILE *ptr;
compras c;
producto p;
int cont=1;
ptr=fopen("Compras.dat","rb");
		if(ptr!=NULL&&existenciacompra()==true)
		{fread(&c,sizeof(c),1,ptr);
		cout<<" "<<setw(20)<<"FECHA"<<setw(20)<<"PRODUCTO"<<setw(20)<<"CANTIDAD"<<setw(20)<<"PRECIO TOTAL"<<endl;
		 while(feof(ptr)==false)
		 {  if(c.estado=='S')
		    {
				p=buscarproducto(c.idprod);
				cout<<cont<<"."<<setw(20)<<c.fecha<<setw(20)<<p.nombre<<setw(20)<<c.cantidad<<setw(20)<<c.preciototal<<endl;
		 
		 }cont++;   
		  fread(&c,sizeof(c),1,ptr);
		 }
	
		}
		else
		{cout<<"No existen compras registrados";
		}
			fclose(ptr);

}
void reporteventa()
{FILE *ptr;
venta v;
cliente c;
vendedor ven;
producto prod;

int cont=1;

ptr=fopen("Ventas.dat","rb");
if(ptr!=NULL)
{fread(&v,sizeof(v),1,ptr);
cout<<"NRO DE VENTA"<<setw(20)<<"FECHA"<<setw(20)<<"PRODUCTO"<<setw(20)<<"CANTIDAD"<<setw(20)<<"PRECIO TOTAL"<<setw(20)<<"CLIENTE"<<setw(20)<<"VENDEDOR"<<endl;
 while(feof(ptr)==false)
	 {if(v.estado=='S')
	 {
		 prod=buscarproducto(v.idprod);
		 c=buscarclienteporidauto(v.idauto);
		 ven=buscarvendedorporidbomba(v.idbomba);
		 cout<<cont;
		 setw(20);
		 cout<<v.fecha;
		 setw(20);
		 cout<<prod.nombre;
		 setw(20);
		 cout<<v.cantidad;
		setw(20);
		 cout<<v.preciototal;
		 setw(20);
		 cout<<c.nombre;
		 setw(20);
		 cout<<ven.nombre;
		 cout<<endl;
		
	 }
	 fread(&v,sizeof(v),1,ptr);
	 cont++;
 }
 
}
else
{cout<<"NO SE HA REGISTRADO NINGUNA VENTA";
}
fclose(ptr);
}
//amb
//anhadir
void añadirvendedor()
{FILE *ptr;
vendedor ven;
int band=0,telefono;
do{ band=0;
    ptr=fopen("Vendedor.dat","ab");
		 if(ptr!=NULL)
		 {
				  ven.idvendedor=generarid(2);
				  do{
				  cout<<"Introduzca nombre: ";
				  gets(ven.nombre);
				  }while(validarnombre(ven.nombre)==false);
				  do{
				  cout<<"Introduzca email";
				  gets(ven.email);
				  }while(validaremail(ven.email)==false);
				  do{
				  cout<<"Introduzca telefono: ";
				  telefono=validarentero();
				  itoa(telefono,ven.telefono,10);
				  }while(validartelefono(ven.telefono)==false);
				  ven.estado='S';
				  do{cout<<"\nesta seguro de sus datos?";
				  cout<<"0.-si\n1.-volver a intentar";
				  band=validarentero();}while(band!=0&&band!=1);
				  if(band==0)
				  fwrite(&ven,sizeof(ven),1,ptr);
				  fclose(ptr);
				  
		 }
		 else
		 {
		 ptr=fopen("Vendedor.dat","wb");
		 fclose(ptr);
		 band=1;
		 }
}while(band==1);

}

void anhadirclientes()
{
	int telfaux,band,nitaux,op;
	cliente c;
	c.estado = 'S';
	do{
		band = 1;
		FILE *ptr = fopen("Cliente.dat", "ab");
		
		if (ptr!=NULL){
			c.idcliente = generarid(1);
			do
			{
				cout << "nombre del cliente: ";
				gets(c.nombre);
			} while (validarnombre(c.nombre) != true);

			
			do
			{
				cout << "email cliente: ";
				gets(c.email);
			} while (validaremail(c.email) != true);
			
			do{
				cout << "telefono: ";
				telfaux = validarentero();
				itoa(telfaux, c.telefono, 10);
			} while (validartelefono(c.telefono) != true);
			
			do
			{
				cout << "NIT: ";
				nitaux = validarentero();
				itoa(nitaux,c.nit,10);
			} while (validarnit(c.nit)!=true);
			do{
				cout << "Esta seguro de haber colocado bien sus datos?: ";
				cout << "1.si\n 2.volver a intentar\n";
				op = validarentero();
			}while (op != 1 && op != 2);
				if (op == 2)
				{
					band = -1;fclose(ptr);
				}
				else{c.estado='S';
					fwrite(&c, sizeof(c), 1, ptr);
					fclose(ptr);
				}
			
		}
		else
		{
			ptr = fopen("Cliente.dat", "wb");
			fclose(ptr);
			band = -1;
		}
	} while (band == -1);
	
}

void añadirproducto()
{FILE *ptr;
producto p;
int band=1,band2;
do{ band=1;
    ptr=fopen("Producto.dat","ab");
		 if(ptr!=NULL)
		 { do{
				  p.idprod=generarid(3);
				 
					  cout<<"\nIntroduzca nombre: ";
					  gets(p.nombre);
				  }while(validarnombre(p.nombre)==false);
				 
					  cout<<"\nIntroduzca precio unitario: ";
					  p.preciounit=validarfloat();	
				  
				   cout<<"\n Esta seguro de haber colocado sus datos correctamente?";
				 do{ cout<<"\n1.SI     2.NO,VOLVER A INTENTAR.";
				  band2=validarentero();
		              }while(band2!=1&&band2!=2);
				 if(band2==1){p.estado='S';
						  fwrite(&p,sizeof(p),1,ptr);
						  fclose(ptr);
				 }
				 else{
				 band=-1;}
				  
		 }
		 else
		 {
		 ptr=fopen("Producto.dat","wb");
		 fclose(ptr);
		 band=-1;
		 }
}while(band==-1);

}
void añadirautomotor()
{FILE *ptr;
automotor a;
int band=1,band2;
do{ band=1;
    ptr=fopen("Automotor.dat","ab");
		 if(ptr!=NULL)
		 {do{
				  a.idauto=generarid(4);
				  do{
				  cout<<"Introduzca placa: ";
				  gets(a.placa);
				  }while(validarplaca(a.placa)==false);
				  a.idcliente=menuclientes();
				  if(a.idcliente==-1)
				  {cout<<"El usuario no esta registrado..agreguelo!!!";
				  getch();band=3;
				  }
				  if(band!=3)
				  {
				  do{
				  cout<<"Esta seguro de sus datos?";
				  cout<<"1.SI    2.NO.VOLVER A INTENTAR";
				  band2=validarentero();
				  }while(band2!=0&&band!=1);
					  if(band==1)
					  {a.estado='S';
					  fwrite(&a,sizeof(a),1,ptr);
					  fclose(ptr);
					  } 
				  }
		 }while(band2==2);
				  
		 }
		 else
		 {
		 ptr=fopen("Producto.dat","wb");
		 fclose(ptr);
		 band=-1;
		 }
}while(band==-1);
}
void añadirbomba()
{FILE *ptr;
bomba b;
producto p;
int band=1,band2;
do{ band=1;
    ptr=fopen("Bomba.dat","ab");
	if(ptr!=NULL)
		 {do{
				  b.idbomba=generarid(5);
				  do{
					  cout<<"Introduzca descripcion: ";
					  gets(b.descripcion);
				  }while(validarnombre(b.descripcion)==false);
				  b.idprod=menuproducto();
				  b.idvendedor=menuvendedor();
				  if(b.idprod==-1)
				  {cout<<"El producto no esta registrado..agreguelo!!!";
				  getch();band=3;
				  }
				 if(b.idvendedor==-1)
				  {cout<<"El vendedor no esta registrado..agreguelo!!!";
				  getch();band=3;
				  }
				 if(band!=3){
				  do{

				  cout<<"Esta seguro de sus datos?";
				  cout<<"1.SI    2.NO.VOLVER A INTENTAR";
				  band2=validarentero();
				  }while(band2!=0&&band!=1);
				  if(band2==1)
				  {fwrite(&p,sizeof(p),1,ptr);
				  fclose(ptr);
				  }
				 }
		 }while(band2==2);
				  
		 }
		 else
		 {
		 ptr=fopen("Bomba.dat","wb");
		 fclose(ptr);
		 band=-1;
		 }
}while(band==-1);
}
//modificar
void modificarcliente()
{
	cliente c; int idcliente,op,telfaux,nitaux;
	idcliente = menuclientes();
	do{if (idcliente != -1)
	{
		c = obtidcliente(idcliente);
		do
		{
			cout << "nombre del cliente: ";
			gets(c.nombre);
		} while (validarnombre(c.nombre) != true);


		do
		{
			cout << "email cliente: ";
			gets(c.email);
		} while (validaremail(c.email) != true);

		do{
			cout << "telefono: ";
			telfaux = validarentero();
			itoa(telfaux, c.telefono, 10);
		} while (validartelefono(c.telefono) != true);

		do
		{
			cout << "NIT: ";
			nitaux = validarentero();
			itoa(nitaux, c.nit, 10);
		} while (validarnit(c.nit) != true);
		do{
			cout << "Esta seguro de haber colocado bien sus datos?: ";
			cout << "1.si\n 2.volver a intentar\n";
			op = validarentero();
		} while (op != 1 && op != 2);
		if (op == 1)
		{
			FILE *ptr = fopen("Cliente.dat", "r+b");
			fseek(ptr, (c.idcliente - 1)*sizeof(c), SEEK_SET);
			fwrite(&c, sizeof(c), 1, ptr);
			fclose(ptr);
		}

	}
	} while (op==2);
}
void modificarproducto() 
{
	producto p;
	int idproducto,band2;
	idproducto = menuproducto();
	do{
		if (idproducto != -1)
		{
			p = buscarproducto(idproducto);
			do{
				cout << "\nIntroduzca nombre: ";
				gets(p.nombre);
			} while (validarnombre(p.nombre) == false);
			
				cout << "\nIntroduzca precio unitario: ";
				p.preciounit=validarfloat();
			
			
			do{
				cout << "\n Esta seguro de haber colocado sus datos correctamente?";
				cout << "\n1.SI     2.NO,VOLVER A INTENTAR.";
				band2 = validarentero();
			} while (band2 != 1 && band2 != 2);
			if (band2 == 1)
			{
				FILE *ptr = fopen("Producto.dat", "r+b");
				fseek(ptr, (p.idprod - 1)*sizeof(p), SEEK_SET);
				fwrite(&p, sizeof(p), 1, ptr);
				fclose(ptr);
			}
		}
		else{
		band2=3;cout<<"\nno existe producto registrado";
		}
	} while (band2 == 2);
}
void modificarautomotor()
{
	automotor A;
	int idautomotor, idcliente, op;
	idautomotor = menuautomotor();
	do{
		if (idautomotor != -1)
		{
			A = buscarautomotorporidauto(idautomotor);
			do{
				cout << "Introduzca placa: ";
				gets(A.placa);
			} while (validarplaca(A.placa) == false);
			cout << "\n escoja el cliente";
			idcliente = menuclientes();
			if (idcliente == -1)
			{
				cout << "El usuario no esta registrado..agreguelo!!!";
				getch(); op = 3;
			}
			else{
				A.idcliente = idcliente;
			}
			if (op != 3)
			{
				do{
					cout << "\n Esta seguro de haber colocado sus datos correctamente?";
					cout << "\n1.SI     2.NO,VOLVER A INTENTAR.";
					op = validarentero();
				} while (op != 1 && op != 2);
			}
			if (op == 1)
			{
				FILE *ptr = fopen("Automotor.dat", "r+b");
				fseek(ptr, (A.idauto - 1)*sizeof(A), SEEK_SET);
				fwrite(&A, sizeof(A), 1, ptr);
				fclose(ptr);
			}
		}
		else{
		cout<<"\nno existe automotor registrado";
		op=3;getch();
		}
	} while (op==2);
}
void modificarvendedor()
{FILE *ptr;
vendedor ven;
int band,y=0,b,telefono;
do{
		ptr=fopen("Vendedor.dat","rb");
		if(ptr!=NULL&& existenciavendedor()==true)
				{
		         b=menuvendedor();
				 if(b==-1)
				 {cout<<"el vendedor no se encuentra registrado...agreguelo!!!";
				 getch();
				 fclose(ptr);
				 }
				 else{
				 ven=buscarvendedorporidvendedor(b);
				 do{
				  cout<<"Introduzca nombre: ";
				  gets(ven.nombre);
				  }while(validarnombre(ven.nombre)==false);
				  do{
				  cout<<"Introduzca email";
				  gets(ven.email);
				  }while(validaremail(ven.email)==false);
				  do{
				  cout<<"Introduzca telefono: ";
				  telefono=validarentero();
				  itoa(telefono,ven.telefono,10);
				  }while(validartelefono(ven.telefono)==false);
				  ven.estado='S';
				  do{cout<<"\nesta seguro de sus datos?";
				  cout<<"0.-si\n1.-volver a intentar";
				  band=validarentero();}while(band!=0&&band!=1);
				  if(band==0)
				  {fseek(ptr,(b-1)*sizeof(ven),SEEK_SET);
				  fwrite(&ven,sizeof(ven),1,ptr);
				  fclose(ptr);
				  }
				 }
		}
		else
		{cout<<"\nNo existe registro de vendedores";
		fclose(ptr);
		}
}while(band==1);
}
void modificarbomba()
{
	bomba b;
	int op,idbomba,idproducto,idvendedor;
	idbomba = menubomba();
	do{
		if (idbomba != -1)
		{
			b = obtidbomba(idbomba);
			do{
				cout << "introducir descripcion de la bomba: ";
				gets(b.descripcion);
			} while (validarnombre(b.descripcion) == false);
			idproducto = menuproducto();
			if (idproducto == -1)
			{
				cout << "El producto no esta registrado..agreguelo!!!";
				getch(); op = 3;
			}
			else
			{
				b.idprod = idproducto;
			}
			idvendedor = menuvendedor();
			if (idvendedor == -1)
			{
				cout << "El vendedor no esta registrado..agreguelo!!!";
				getch(); op = 3;
			}
			else
			{
				b.idvendedor = idvendedor;
			}
			if (op != 3)
			{
				do{
					cout << "\n Esta seguro de haber colocado sus datos correctamente?";
					cout << "\n1.SI     2.NO,VOLVER A INTENTAR.";
					op = validarentero();
				} while (op != 1 && op != 2);
			}
			if (op == 1)
			{
				FILE *ptr = fopen("Bomba.dat", "r+b");
				fseek(ptr, (b.idbomba - 1)*sizeof(b), SEEK_SET);
				fwrite(&b, sizeof(b), 1, ptr);
				fclose(ptr);
			}
		}
	} while (op==2);
}
//borrar
void borrarcliente()
{FILE *ptr;
 cliente c;
 int h,band,y;
 ptr=fopen("Cliente.dat","r+b");
 if(ptr!=NULL)
		 { h=menuclientes();
		  if(h>0)
			  {  fseek(ptr,(h-1)*sizeof(c),SEEK_SET);
			  do{
					cout<<"\nEsta seguro que quiere eliminar a:\n"<<c.nombre<<"  "<<c.telefono<<"   "<<c.email<<endl;
					cout<<"\n1.SI  2.NO\n";
					cout<<"\nEscoja una opcion: \n";
					cin>>y;

			  }while(y!=1&&y!=0);
              if(y==1){ 
			   c.estado='N';
			   eliminarautomotoresporcliente(h);
			  }
			  else
			  {band=3;
			  }
			  }
		  else
				  {cout<<"El cliente a eliminar no existe";
		          getch();
				  }

  fclose(ptr);
		}
 else
 {cout<<"No existe el archivo";
 fclose(ptr);
 }
}
//menu
void reportesmenu()
{
	int i, p, q;
	do{
		cout << "\t REPORTES:\t";
		cout << "\n1.GENERALES\n";
		cout << "\n2.POR TIEMPO\n";
		cout << "\n0.SALIR";
		cout << "\nElija una opcion:";
		cin >> i;
		system("cls");
		switch (i)
		{
					case 1: do{
						cout << "\n1.Clientes";
						cout << "\n2.Vendedores";
						cout << "\n3.Productos";
						cout << "\n4.Automotores";
						cout << "\n5.Bombas";
						cout << "\n6.Compras";
						cout << "\n7.Ventas";
						cout << "\n0.SALIR";
						cout << "\nEscoja una opcion:\n ";
						cin >> p;
						system("cls");
						switch (p)
						{
						case 1: 
							reporteclientesgenerales();
							getch();
							
							break;
						case 2: 
							reportevendedorgenerales();
							getch();
							comprar();
							break;
						case 3: 
							reporteproductosgenerales();
							getch();
							break;
						case 4: 
							reporteautomotorgenerales();
							getch();
							break;
						case 5: 
							reportebombagenerales();
							getch();
							break;
						case 6: 
							reportecompragenerales();
							getch();
							break;
						case 7: 
							reporteventa();
							getch();
							break;
						case 0: cout << "SALIR";
								break;
						default:cout << "ERROR";
							getch();
							break;
						}
						system("cls");
					} while (p != 0);
					
					break;
		case 2: do{
			cout << "\n1.Ranking Bomba";
			cout << "\n2.Ranking Clientes";
			cout << "\n3.Compras";
			cout << "\n4.Ventas";
			cout << "\n0.SALIR";
			cout << "\nEscoja una opcion: \n";
			cin >> q;
			system("cls");
			switch (q)
			{
			case 1:
				rankingbomba();
				getch();
				break;
			case 2: 
				rankingclientes();
				getch();
				break;
			case 3: 
				reporteporfechacompras();
				getch();
				break;
			case 4: 
				reporteporfechaventas();
				getch();
				break;
			case 0:cout << "SALIR";
				break;
			default:cout << "ERROR";
				getch();
				break;
			}
			system("cls");

		} while (q != 0);
		break;
		case 0: cout << "SALIR";
				break;
		default:cout << "ERROR";
			getch();
			break;

		}
		system("cls");

	} while (i != 0);
}
void ABMreporte()
{
	int y;
	do{
		cout << "A\244adir/Modificar/Borrar";
		cout << "\n1.Clientes";
		cout << "\n2.Vendedores";
		cout << "\n3.Productos";
		cout << "\n4.Automotores";
		cout << "\n5.Bombas";
		cout << "\n0.SALIR";
		cout << "\nEscoja una opcion:\n ";
		cin >> y;
		system("cls");
		switch (y)
		{
		case 1: 
			anhadirclientes();
			getch();
			break;
		case 2: 
			añadirvendedor();
			getch();
			break;
		case 3:
			añadirproducto();
			getch();
			break;
		case 4: 
			añadirautomotor();
			getch();
			break;
		case 5: 
			añadirbomba();
			getch();
			break;
		
		case 0: cout << "SALIR";
			break;
		default:cout << "ERROR";
			getch();
			break;
		}
		system("cls");
	} while (y != 0);
	
}


void main()
{
	int o;

	do{
		cout << "\tMENU\t";
		cout << "\n1.Vender\n";
		cout << "\n2.Comprar\n";
		cout << "\n3.Reportes\n";
		cout << "\n4.A\244adir/Borrar/Modificar\n";
		cout << "\n0.SALIR";
		cout << "\nEscoja una opcion: \n";
		cin >> o;
		system("cls");
		switch (o)
		{
		case 1:
			vender();
			getch();
			
			break;
		case 2: 
			comprar();
			getch();
			break;
		case 3:reportesmenu();
			   getch();
				break;
		case 4:ABMreporte();
			getch();
			break;
		case 0: cout << "SALIR";
			break;
		default: cout << "ERROR";
			getch();
			break;
		}
		system("cls");
	} while (o!=0);
}
//desarrollo de funciones
//menus
int menuclientes()
{FILE *ptr;
cliente c;
int y=1,z,band;
do{band=1;
ptr=fopen("Cliente.dat","rb");
if (ptr!=NULL&&existenciacliente()==true)
	{fread(&c,sizeof(c),1,ptr);

     while(feof(ptr)==false)
	 {if(c.estado=='S')
	 {cout<<y<<" . "<<c.nombre<<cout.width(20)<<c.email<<cout.width(20)<<c.telefono<<endl;
	 }
	  fread(&c,sizeof(c),1,ptr);
	  y++;
	 }
	 cout<<"Elige una opcion...si no es ninguno de ellos presione 0 \n";
	 z=validarentero();
	 if(z==0){
	 fclose(ptr);
	 return -1;
	 }
	 else{
	 fseek(ptr,(z-1)*sizeof(c),SEEK_SET);
	 if(feof(ptr)==true)
	 band=-1;
	 fclose(ptr);
	 if(band!=-1)
	 {fclose(ptr);
	 return c.idcliente;
	 }
	 }
}
	else
	{fclose(ptr);
      return -1;

	}

}while(band==-1);
}
int menuproducto()
{FILE *ptr;
producto p;
int y=1,z,band;
do{band=1;
ptr=fopen("Producto.dat","rb");
if (ptr!=NULL&&existenciaproducto()==true)
	{fread(&p,sizeof(p),1,ptr);
	cout<<"n"<<" . "<<"NOMBRE"<<cout.width(20)<<"PRECIO UNITARIO"<<cout.width(20)<<"STOCK"<<endl;
     while(feof(ptr)==false)
	 {if(p.estado=='S')
	 {cout<<y<<" . "<<p.nombre<<cout.width(20)<<p.preciounit<<cout.width(20)<<p.stock<<endl;}
	  fread(&p,sizeof(p),1,ptr);y++;
	 }
	 cout<<"Elige una opcion...si no es ninguno de ellos presione 0 \n";
	 z=validarentero();
	 if(z==0){
	fclose(ptr);
	 return -1;
	 }
	 else{
	 fseek(ptr,(z-1)*sizeof(p),SEEK_SET);
	 if(feof(ptr)==true)
	 band=-1;
	 fclose(ptr);
	 if(band!=-1)
	 {
	 return p.idprod;
	 }
	 }
}
	else
	{fclose(ptr);
      return -1;

	}

}while(band==-1);
}
int menuvendedor()
{FILE *ptr;
vendedor ven;
int y=1,z,band;
do{band=1;
ptr=fopen("Vendedor.dat","rb");
if (ptr!=NULL&&existenciavendedor()==true)
	{fread(&ven,sizeof(ven),1,ptr);
	cout<<"n"<<" . "<<"NOMBRE"<<cout.width(20)<<"EMAIL"<<cout.width(20)<<"TELEFONO"<<endl;
     while(feof(ptr)==false)
	 {if(ven.estado=='S')
	 {cout<<y<<" . "<<ven.nombre<<cout.width(20)<<ven.email<<cout.width(20)<<ven.telefono<<endl;}
	  fread(&ven,sizeof(ven),1,ptr);y++;
	 }
	 cout<<"Elige una opcion...si no es ninguno de ellos presione 0 \n";
	 z=validarentero();
	 if(z==0)
	 {
		fclose(ptr);
		 return -1;
	 }
	 else{
	 fseek(ptr,(z-1)*sizeof(ven),SEEK_SET);
	 if(feof(ptr)==true)
	 band=-1;
	 fclose(ptr);
	 if(band!=-1)
	 {
	 return ven.idvendedor;
	 }
	 }
}
	else
	{fclose(ptr);
      return -1;

	}

}while(band==-1);
}
bool menuventas(venta &v){
	vendedor ven;producto prod;bomba bom;int cont=1;int op;
	FILE *ptr=fopen("Bomba.dat","rb");
	do{if(ptr!=NULL&&existenciavendedor()==true)
	{fread(&bom,sizeof(bom),1,ptr);
	  cout<<"\nseleccione que vendedor es usted";
	  cout<<"\n  vendedor";
	  cout.width(20);
	  cout<<"producto";
	  cout.width(20);
	  cout<<"precio unitario"<<endl;
	  while(feof(ptr)==false)
	  {ven=buscarvendedorporidvendedor(bom.idvendedor);
	  prod=buscarproducto(bom.idprod);
		  if(ven.estado=='S')
		 { cout<<cont<<".-"<<ven.nombre;
		  cout.width(20);
		  cout<<prod.nombre;
		  cout.width(20);
		  cout<<prod.preciounit<<endl;
		  fread(&bom,sizeof(bom),1,ptr);
		  }cont++;
	  }
	  cout<<"\n0.-salir";
	  op=validarentero();
	  if(op!=0)
	  {fseek(ptr,(cont-1)*sizeof(bom),SEEK_SET);
	    if(feof(ptr)==false)
		{ fread(&bom,sizeof(bom),1,ptr);fclose(ptr);
		v.idbomba=bom.idbomba;
			prod=buscarproducto(bom.idprod);
			do{cout<<"ingrese la cantidad a vender";
			v.cantidad=validarfloat();}while(v.cantidad>prod.stock||v.cantidad<0);
			v.preciototal=v.cantidad*prod.preciounit;
			cout<<"\n el precio total sera "<<v.preciototal<<endl;return true;
		}
		else{
		
			cout<<"no existe el registro seleccionado";
			op=-5;fclose(ptr);
		}

	  }
	}
	else{
	cout<"\nno existe ningun vendedor registrado";fclose(ptr);return false;
	getch();
	}
	}
	while(op==-5);

}
bool menucompras(compras &c)
{producto p;int cont=1,op;
   FILE *ptr=fopen("Producto.dat","rb");
	do{ 
   if(ptr!=NULL&&existenciaproducto()==true)
	   {
		   fread(&p,sizeof(p),1,ptr);
		   cout<<"\n seleccione su producto";
		   cout<<"\nproducto";
		   cout.width(20);
		   cout<<"stock"<<endl;
		   while(feof(ptr)==false)
		   {
			   cout<<cont<<".-";
			   cout<<p.nombre;
			   cout.width(20);
			   cout<<p.stock;
			   cout<<endl;
			   cont++;
			   fread(&p,sizeof(p),1,ptr);
		   }
		   cout<<"\n0.-salir";
		   op=validarentero();
		   if(op!=0)
		   {
			fseek(ptr,(cont-1)*sizeof(p),SEEK_SET);
			if(feof(ptr)==false)
			{ fread(&p,sizeof(p),1,ptr);fclose(ptr);
			c.idprod=p.idprod;
			do{cout<<"\n que cantidad comprara?";
			c.cantidad=validarfloat();}while(c.cantidad<0);
			cout<<"\n cuanto es el precio total de la compra";
			c.preciototal=validarfloat();return true;
			}
			else{
			cout<<"no existe el registro seleccionado";
				op=-5;fclose(ptr);
			}
		   }
	   }
	   else{
		 cout<<"\n no existe producto registrado,primero registrar";fclose(ptr);return false;
		 getch();
	   }
	}while(op==-5);
}
int menuautomotor()
{FILE *ptr;
automotor a;
cliente c;
int y=1,z,band;
do{band=1;
ptr=fopen("Automotor.dat","rb");
	if (ptr!=NULL&&existenciaautomotor()==true)
	{fread(&a,sizeof(a),1,ptr);
	cout<<"n"<<" . "<<"Placa"<<cout.width(20)<<"Cliente"<<endl;
     while(feof(ptr)==false)
	 {if(a.estado='S')
	  {c=obtidcliente(a.idcliente);
	  cout<<y<<" . "<<a.placa<<cout.width(20)<<c.nombre<<endl;
	  fread(&a,sizeof(a),1,ptr);
	 }
	 y++;
	 }
	 cout<<"Elige una opcion...si no es ninguno de ellos presione 0 \n";
	 z=validarentero();
	 if(z==0)
	 {
		fclose(ptr);
		 return -1;
	 }
	 else{
	 fseek(ptr,(z-1)*sizeof(a),SEEK_SET);
	 if(feof(ptr)==true)
	 band=-1;
	 fclose(ptr);
	 if(band!=-1)
	 {
	 return a.idauto;
	 }
	 }
}
	else
	{fclose(ptr);
      return -1;

	}

}while(band==-1);
}
int menubomba()
{FILE *ptr;
bomba b;
int y=1,z,band;
do{band=1;
ptr=fopen("Bomba.dat","rb");
	if (ptr!=NULL&&existenciabomba()==true)
	{fread(&b,sizeof(b),1,ptr);
	cout<<"n"<<" . "<<"DESCRIPCION"<<endl;
     while(feof(ptr)==false)
	 {if(b.estado=='S')
	  {cout<<y<<" . "<<b.descripcion<<endl;
	  fread(&b,sizeof(b),1,ptr);
	 }y++;
	 }
	 cout<<"Elige una opcion...si no es ninguno de ellos presione 0 \n";
	 z=validarentero();
	 if(z==0)
	 {
		fclose(ptr);
		 return -1;
	 }
	 else{
	 fseek(ptr,(z-1)*sizeof(b),SEEK_SET);
	 if(feof(ptr)==true)
	 band=-1;
	 fclose(ptr);
	 if(band!=-1)
	 {
	 return b.idbomba;
	 }
	 }
}
	else
	{fclose(ptr);
      return -1;

	}

}while(band==-1);
}
int menucomprasid()
{FILE *ptr;
compras c;int num;
int y=1,z,band;
do{band=1;
ptr=fopen("Compras.dat","rb");
if (ptr!=NULL&&existenciacompra()==true)
	{fread(&c,sizeof(c),1,ptr);
	cout<<"n"<<" . "<<"FECHA"<<cout.width(20)<<"CANTIDAD"<<cout.width(20)<<"PRECIO TOTAL"<<endl;
     while(feof(ptr)==false)
	 {cout<<y<<" . "<<c.fecha<<cout.width(20)<<c.cantidad<<cout.width(20)<<c.preciototal<<endl;
	  fread(&c,sizeof(c),1,ptr);
	 }
	 cout<<"Elige una opcion...si no es ninguno de ellos presione 0 \n";
	 z=validarentero();
	 if(z==0){
	fclose(ptr);
	 return -1;
	 }
	 else{
	 fseek(ptr,(z-1)*sizeof(c),SEEK_SET);
	 if(feof(ptr)==true)
	 band=-1;
	 fclose(ptr);
	 if(band!=-1)
	 {
	 return c.idcompra;
	 }
	 }
}
	else
	{fclose(ptr);
      return -1;

	}

}while(band==-1);
}
int menuventasid()
{FILE *ptr;
venta v;
int y=1,z,band;
do{band=1;
ptr=fopen("Ventas.dat","rb");
	if (ptr!=NULL&&existenciaventas()==true)
	{fread(&v,sizeof(v),1,ptr);
	cout<<"n"<<" . "<<"FECHA"<<cout.width(20)<<"CANTIDAD"<<cout.width(20)<<"PRECIO TOTAL"<<endl;
     while(feof(ptr)==false)
	 {cout<<y<<" . "<<v.fecha<<cout.width(20)<<v.cantidad<<cout.width(20)<<v.preciototal<<endl;
	  fread(&v,sizeof(v),1,ptr);
	 }
	 cout<<"Elige una opcion...si no es ninguno de ellos presione 0 \n";
	 z=validarentero();
	 if(z==0){
	fclose(ptr);
	 return -1;
	 }
	 else{
	 fseek(ptr,(z-1)*sizeof(v),SEEK_SET);
	 if(feof(ptr)==true)
	 band=-1;
	 fclose(ptr);
	 if(band!=-1)
	 {
	 return v.idventa;
	 }
	 }
}
	else
	{fclose(ptr);
      return -1;

	}

}while(band==-1);
}
//validar
bool validarplaca(char placa[])
{
	int i=0;
	if(strlen(placa)!=7)
	{cout<<"error en placa";getch();
		return false;
    }
	else {
				for(i=0;i<4;i++)
				{
					if(placa[i]!='0'&&placa[i]!='1'&&placa[i]!='2'&&placa[i]!='3'&&placa[i]!='4'&&placa[i]!='5'&&placa[i]!='6'&&placa[i]!='7'&&placa[i]!='8'&&placa[i]!='9')
					{cout<<"error en placa";getch();
						return false;
					}     
				}
				for(i=i;i<7;i++)
				{
					if(placa[i]<'A'||placa[i]>'Z')
					{cout<<"error en placa";getch();return false;}
				}
	     }
	return true;
}
int validarentero()
{
	int r, i; bool k;
	char num[12];
	do{
		do{
			cout << "\ningrese numero: ";
			gets_s(num);
		} while (strlen(num) == 0);
		i = 0; k = true;
		if (num[0] == '-')
		{
			i++;
			if (strlen(num) == 1)
				k = false;
		}
		while (i<strlen(num))
		{
			if ((num[i] != '0') && (num[i] != '1') && (num[i] != '2') && (num[i] != '3') && (num[i] != '4') && (num[i] != '5') && (num[i] != '6') && (num[i] != '7') && (num[i] != '8') && (num[i] != '9'))
			{
				k = false; break;
			}
			i++;
		}
		if (k == false){ cout << "ERROR FATAL : DATO NO NUMERICO"; }
	} while (k == false);
	r = atoi(num);

	return(r);
}
float validarfloat()
{
	float r;int i; bool k;
	char num[12];
	do{
		do{
			cout << "\ningrese numero: ";
			gets_s(num);
		} while (strlen(num) == 0);
		i = 0; k = true;
		if(num[0]=='.')
		     {k=false;}
		if (num[0] == '-')
		{  
			i++;
			if (strlen(num) == 1)
				k = false;
		}
		while (i<strlen(num))
		{
			if ((num[i]!='.')&&(num[i] != '0') && (num[i] != '1') && (num[i] != '2') && (num[i] != '3') && (num[i] != '4') && (num[i] != '5') && (num[i] != '6') && (num[i] != '7') && (num[i] != '8') && (num[i] != '9'))
			{
				k = false; break;
			}
			i++;
		}
		if (k == false){ cout << "ERROR FATAL : DATO NO NUMERICO"; }
	} while (k == false);
	r = atof(num);

	return(r);
}
bool validaremail(char e[80])

{
	int n,i,cont=0;
	n = strlen(e);
	if(n<7)
	return false;
		if (e[n - 1] != 'm'||e[n - 2] != 'o'||e[n - 3]!= 'c'||e[n - 4]!= '.')
			return false;


	if (e[0] == '@')
		return false;
	for (i = 1; i < n-5; i++)
	{
		if(e[i] == '@')
		cont++;
		
	}
	if (cont != 1)
	{
		return false;
	}
	
		return true;
	
}
bool validarnombre(char nombre[30])
{
	if(strlen(nombre)==0)
		return false;
	if(nombre[0]==' ')
		return false;
	for(int i=0;i<strlen(nombre);i++)
				{
					if(nombre[i]==' ')
					{}
					else{
					if(nombre[i]<'A'||nombre[i]>'Z')
					{cout<<"\nerror en nombre";getch();return false;}
					}
				}
	return true;
}
bool validarnit(char ni[10])
{
	int n;
	n = strlen(ni);
	if (n >= 7 && n <= 10)
	{
		return true;
	}
	return false;
}
bool validartelefono(char t[12])
{
	int n;
	n = strlen(t);
	if (t[0] == '3'&&n==7)
	{
		return true;
	}
	
		if (t[0] == '7'&&n==8)
		{
				return true;
		}
	
	return false;
}
//buscar
int buscaridplaca(char placa[])
{
	automotor A;
	FILE * ptr=fopen("Automotor.dat","rb");
	if(ptr!=NULL)
	{
		fread(&A,sizeof(A),1,ptr);
		while(feof(ptr)==false)
		{
			if(strcmp(A.placa,placa)==0)
			{
				fclose(ptr);
				return A.idauto;
			}
			fread(&A,sizeof(A),1,ptr);
		}
		fclose(ptr);
		return -1;
	}
}
vendedor buscarvendedorporidvendedor(int id)
{vendedor v;

	FILE *ptr=fopen("Vendedor.dat","rb");
    fread(&v,sizeof(v),1,ptr);
	while(feof(ptr)==false)
	 {
		 if(v.idvendedor==id)
		 {fclose(ptr);
			 return v;
		 }
	}
}
producto buscarproducto(int idprod)
{producto p;

	FILE *ptr=fopen("Producto.dat","rb");
    fread(&p,sizeof(p),1,ptr);
	while(feof(ptr)==false)
	 {
		 if(p.idprod==idprod)
		 {fclose(ptr);
			 return p;
		 }
	}
}
void buscarnombrecliente(int id,char nombre[30])
{cliente c;
	FILE *ptr=fopen("Cliente.dat","rb");
	fread(&c,sizeof(c),1,ptr);
	while(feof(ptr)==false)
	{
		if(c.idcliente==id)
		{
			strcpy(nombre,c.nombre);
		}

	}
	fclose(ptr);
}
vendedor buscarvendedorporidbomba(int id)
{
	vendedor v;bomba b;
	FILE *ptr=fopen("Bomba.dat","rb");
    fread(&b,sizeof(b),1,ptr);
	while(feof(ptr)==false)
	 {
		 if(b.idbomba==id)
		 {fclose(ptr);
		 v=buscarvendedorporidvendedor(b.idvendedor);return v;
		 }
	       fread(&b,sizeof(b),1,ptr);
	}
	
}
automotor buscarautomotorporidauto(int id)
{
	automotor A;
	FILE *ptr=fopen("Automotor.dat","rb");
	if(ptr!=NULL)
	{
		fread(&A,sizeof(A),1,ptr);
		while(feof(ptr)==false)
		{
			if(A.idauto==id&& A.estado=='S')
			{fclose(ptr);
				return A;
			}
			fread(&A,sizeof(A),1,ptr);
		}fclose(ptr);
		
	}
	else{fclose(ptr);
	cout<<"no existe registro de auto";
	}
}
bomba obtidbomba(int x)
{FILE *ptr;
bomba b;
ptr=fopen("Bomba.dat","rb");
		if(ptr!=NULL)
		{
			fread(&b,sizeof(b),1,ptr);
			while(feof(ptr)==false && b.idvendedor!=x)
			{
				fread(&b,sizeof(b),1,ptr);
			}
			fclose(ptr);
			if(b.estado=='S')
			{
			return b;
			}
		}
}
cliente obtidcliente(int x)
{FILE *ptr;
cliente c;
ptr=fopen("Cliente.dat","rb");
		if(ptr!=NULL)
		{
			fread(&c,sizeof(c),1,ptr);
			while(feof(ptr)==false && c.idcliente!=x)
			{
				fread(&c,sizeof(c),1,ptr);
			}
			fclose(ptr);
			if( c.estado=='S')
			return c;
		}
}
vendedor obtidvendedor(int x)
{FILE *ptr;
vendedor ven;
ptr=fopen("Vendedor.dat","rb");
		if(ptr!=NULL)
		{
			fread(&ven,sizeof(ven),1,ptr);
			while(feof(ptr)==false && ven.idvendedor!=x)
			{
				fread(&ven,sizeof(ven),1,ptr);
			}
			fclose(ptr);
			if(ven.estado=='S')
			return ven;
		}
}
cliente buscarclienteporidauto(int idauto)
{
	automotor a;
cliente c;

	FILE *ptr=fopen("Automotor.dat","rb");
    fread(&a,sizeof(a),1,ptr);
	while(feof(ptr)==false)
	 {if(a.estado=='S'){
		 if(a.idauto==idauto)
		 {c=obtidcliente(a.idcliente);
		 }
	}}
	fclose(ptr);
	return c;
}
//existencia
bool existenciaventas()
{venta v;
	FILE *ptr=fopen("Ventas.dat","rb");
	fread(&v,sizeof(v),1,ptr);
	while(feof(ptr)==false)
	{
		if(v.estado=='S')
		{fclose(ptr);
			return true;}

	}
	fclose(ptr);
	return false;
}
bool existenciaautomotor()
{
	automotor a;
FILE *ptr=fopen("Automotor.dat","rb");
	fread(&a,sizeof(a),1,ptr);
	while(feof(ptr)==false)
	{
		if(a.estado=='S')
		{fclose(ptr);
			return true;}

	}
	fclose(ptr);
	return false;

}
bool existenciabomba()
{
	bomba c;
FILE *ptr=fopen("Bomba.dat","rb");
	fread(&c,sizeof(c),1,ptr);
	while(feof(ptr)==false)
	{
		if(c.estado=='S')
		{fclose(ptr);
			return true;}

	}
	fclose(ptr);
	return false;
}
bool existenciacompra(){
	compras c;
FILE *ptr=fopen("Compras.dat","rb");
	fread(&c,sizeof(c),1,ptr);
	while(feof(ptr)==false)
	{
		if(c.estado=='S')
		{fclose(ptr);
			return true;}

	}
	fclose(ptr);
	return false;
}
bool existenciacliente()
{cliente c;
FILE *ptr=fopen("Cliente.dat","rb");
	fread(&c,sizeof(c),1,ptr);
	while(feof(ptr)==false)
	{
		if(c.estado=='S')
		{fclose(ptr);
			return true;}

	}
	fclose(ptr);
	return false;

}
bool existenciavendedor()
{vendedor v;
	FILE *ptr=fopen("Vendedor.dat","rb");
	fread(&v,sizeof(v),1,ptr);
	while(feof(ptr)==false)
	{
		if(v.estado=='S')
		{fclose(ptr);
			return true;}

	}
	fclose(ptr);
	return false;

}
bool existenciaproducto()
{producto p;
	FILE *ptr=fopen("Producto.dat","rb");
	fread(&p,sizeof(p),1,ptr);
	while(feof(ptr)==false)
	{
		if(p.estado=='S')
		{fclose(ptr);
			return true;}

	}
	fclose(ptr);
	return false;

}
//fecha

int compararfechas(fechas f1,fechas f2)
{
	if(f1.anho<f2.anho)
	{
		return 1;
	}
	else
	{
		if(f1.anho>f2.anho)
		{
			return -1;
		}
		else
		{
			if(f1.anho==f2.anho)
			{
				if(f1.mes<f2.mes)
				{
					return 1;
				}
				else
				{
					if(f1.mes>f2.mes)
						return -1;
					else
					{
						if(f1.mes==f2.mes)
						{
							if(f1.dia<f2.dia)
							{
								return 1;
							}
							else
							{
								if(f1.dia>f2.dia)
									return -1;
								else
									return 0;
							}
						}	
					}
				}
			}	
		}
	}
}
void convertirfecha(fechas &f,char fecha[10])
{char dia[2],mes[2],anho[4];
   dia[0]=fecha[0];
   dia [1]=fecha[1];
   mes[0]= fecha[2];
   mes[1]=fecha[3];
   anho[0]=fecha[4];
   anho[1]=fecha[5];
   anho[2]=fecha[6];
   anho[3]=fecha[7];
   f.dia=atoi(dia);
   f.mes=atoi(mes);
   f.anho=atoi(anho);
}
void barrafecha(char fecha[10])
{char aux[10];
  aux[0]=fecha[0];
  aux[1]=fecha[1];
  aux[2]='/';
  aux[3]=fecha[2];
  aux[4]=fecha[3];
  aux[5]='/';
  aux[6]=fecha[4];
  aux[7]=fecha[5];
  aux[8]=fecha[6];
  aux[9]=fecha[7];
  
}
void fecha(char fecha[]){
	int day, month, year,fechatotal,band=1;
	char fechaaux[10];

do{band=1;
	cout << "Ingrese el d\241a: "; cin >> day; //Día 
	cout << "\nIngrese el mes: "; cin >> month; //Mes 
	cout << "\nIngrese el a\244o: "; cin >> year; //Año 

	if ((month == 2) && !((year % 4 == 0 && year % 100 != 0) || (year % 400 == 0)) && ((day > 28) || (day <= 0)))
	{cout << "\n\nFecha incorrecta: Este mes solo tiene 28 d\241as"; band=2;}

	else
	{
		if ((month == 2) && ((year % 4 == 0 && year % 100 != 0) || (year % 400 == 0)) && ((day > 29) || (day <= 0)))
		{cout << "\n\nFecha incorrecta: Este mes solo tiene 29 d\241as"; band=2;}

	


			else
			{
				if (((month == 1) || (month == 3) || (month == 5) || (month == 7) || (month == 8) || (month == 10) || (month == 12)) && ((day > 31) || (day <= 0)))
				{cout << "\n\nFecha incorrecta: Este mes solo tiene 31 d\241as"; band=2;}

				else
				{
					if (((month == 4) || (month == 6) || (month == 9) || (month == 11)) && ((day > 30) || (day <= 0)))
					{cout << "\n\nFecha incorrecta: Este mes solo tiene 30 d\241as"; band=2;}

					else
					{
						if ((month > 12) || (month <= 0))
						{cout << "\n\nFecha incorrecta: El a\244o solo tiene 12 meses"; band=2;}
						else{
							if(year<2000||year>2100)
							{cout << "\n\nFecha incorrecta"; band=2;}
						else{
							if (day < 10 && month < 10)
								{
							fechatotal=year+month*pow(10,4)+day*pow(10,6);
							fecha[0]='0';
							itoa(fechatotal,fechaaux,10);
							strcat(fecha,fechaaux);
							     
							     }
							else
							{
								if (day < 10 && month >= 10)
									{
								        fechatotal=year+month*pow(10,4)+day*pow(10,6);
							fecha[0]='0';
							itoa(fechatotal,fechaaux,10);
							strcat(fecha,fechaaux);
								    }


								else
								{
									  fechatotal=year+month*pow(10,4)+day*pow(10,6);
							            itoa(fechatotal,fecha,10);

								}
							}
						}
					}
				}
			}
		}
	}
}while(band==2);

}
void quitarbarrasfecha(char fecha[30])
{char aux[30];
  aux[0]=fecha[0];
  aux[1]=fecha[1];
  aux[2]=fecha[3];
  aux[3]=fecha[4];
  aux[4]=fecha[6];
  aux[5]=fecha[7];
  aux[6]=fecha[8];
  aux[7]=fecha[9];
  strcpy(fecha,aux);
}

//otros
int generarid(int tipo){
	FILE *ptr;
	switch(tipo){
	case 1:
		cliente c;
		ptr=fopen("CLiente.dat","rb");
		fread(&c,sizeof(c),1,ptr);
		if(feof(ptr)==true)
		{    fclose(ptr);
		c.idcliente=1;return c.idcliente ;
			
		}
		else{
			fseek(ptr,-sizeof(c),SEEK_END);
			fread(&c,sizeof(c),1,ptr);
			fclose(ptr);
			c.idcliente++;return c.idcliente;
		}
		break;
	case 2:
		vendedor ven;
		ptr=fopen("Vendedor.dat","rb");
		fread(&ven,sizeof(ven),1,ptr);
		if(feof(ptr)==true)
		{    fclose(ptr);
		ven.idvendedor=1;return ven.idvendedor ;
			
		}
		else{
			fseek(ptr,-sizeof(ven),SEEK_END);
			fread(&ven,sizeof(ven),1,ptr);
			fclose(ptr);
			ven.idvendedor++;return ven.idvendedor;
		}
		break;
	case 3:
		producto p;
		ptr=fopen("Vendedor.dat","rb");
		fread(&p,sizeof(p),1,ptr);
		if(feof(ptr)==true)
		{    fclose(ptr);
		p.idprod=1;return p.idprod ;
			
		}
		else{
			fseek(ptr,-sizeof(p),SEEK_END);
			fread(&p,sizeof(p),1,ptr);
			fclose(ptr);
			p.idprod++;return p.idprod;
		}
		break;
	case 4:
	automotor a;
		ptr=fopen("Automotor.dat","rb");
		fread(&a,sizeof(a),1,ptr);
		if(feof(ptr)==true)
		{    fclose(ptr);
		a.idauto=1;return a.idauto ;
			
		}
		else{
			fseek(ptr,-sizeof(a),SEEK_END);
			fread(&a,sizeof(a),1,ptr);
			fclose(ptr);
			a.idauto++;return a.idauto;
		}
		break;
	case 5:
		bomba b;
				ptr=fopen("Bomba.dat","rb");
		fread(&b,sizeof(b),1,ptr);
		if(feof(ptr)==true)
		{    fclose(ptr);
		b.idbomba=1;return b.idbomba ;
			
		}
		else{
			fseek(ptr,-sizeof(b),SEEK_END);
			fread(&b,sizeof(b),1,ptr);
			fclose(ptr);
			b.idbomba++;return b.idbomba;
		}
		break;
	case 6:
		compras com;
	    ptr=fopen("Compras.dat","rb");
		fread(&com,sizeof(com),1,ptr);
		if(feof(ptr)==true)
		{    fclose(ptr);
		com.idcompra=1;return com.idcompra ;
			
		}
		else{
			fseek(ptr,-sizeof(com),SEEK_END);
			fread(&com,sizeof(com),1,ptr);
			fclose(ptr);
			com.idcompra++;return com.idcompra;
		}
		break;
	case 7:
			venta v;
		ptr=fopen("Ventas.dat","rb");
		fread(&v,sizeof(v),1,ptr);
		if(feof(ptr)==true)
		{    fclose(ptr);
		v.idventa=1;return v.idventa;
			
		}
		else{
			fseek(ptr,-sizeof(v),SEEK_END);
			fread(&v,sizeof(v),1,ptr);
			fclose(ptr);
			v.idventa++;return v.idventa;
		}
		break;
	}

}
void anhadirventa(venta v)
{
	int band = 0;
	do{
		band = 0;
		FILE *ptr = fopen("Ventas.dat", "ab");

		if (ptr != NULL)
		{
			fwrite(&v, sizeof(v), 1, ptr);
			fclose(ptr);
		}
		else
		{
			ptr = fopen("Ventas.dat", "wb");
			fclose(ptr);
			band = -1;

		}
	} while (band == -1);
}
void anhadircompra(compras c)
{
	FILE *ptr=fopen("Compras.dat","ab");
	fwrite(&c,sizeof(c),1,ptr);
	fclose(ptr);
}
int calcularventasporcliente(int id,fechas f1,fechas f2)
{int s=0;automotor a;venta v;fechas f3;char fechaaux[10];
	FILE *ptr=fopen("Automotor","rb");
	fread(&a,sizeof(a),1,ptr);
	while(feof(ptr)==false)
	{
		if(a.idcliente==id&&a.estado=='S')
		{
             FILE *ptr2=fopen("Ventas.dat","rb");
			 if(ptr!=NULL)
			 {
				 fread(&v,sizeof(v),1,ptr2);
				 while(feof(ptr)==false)
				 {
					 if(a.idauto==v.idauto&&v.estado=='S')
					 {   
						 strcpy(fechaaux,v.fecha);
						 quitarbarrasfecha(fechaaux);
						convertirfecha(f3,fechaaux);
						 if(((compararfechas(f1,f3)==0)||(compararfechas(f1,f3)==1))&&((compararfechas(f3,f2)==0)||(compararfechas(f3,f2)==1)))
						 {s=s+v.preciototal;}
					 }
					 fread(&v,sizeof(v),1,ptr2);
				 }
				 fclose(ptr2);
			 }
			 else
			 { fclose(ptr);fclose(ptr2);
				 return 0;//retorno cero porque no hay registros de ventas entonces nadie compro nada
			 }
		}
	}fclose(ptr);return s;
	
}
void ordenarmatriz(int mat[fil][2],int n)
{int aux;
	for(int i=0;i<(n-1);i++)
	{
		for(int j=i;j<n;j++)
		{
			if(mat[i][1]<mat[j][1])
			{
				aux=mat[i][1];
				mat[i][1]=mat[j][1];
				mat[j][i]=aux;
			}
		}
	}
}
int calcularventasporbomba(int idbomba,fechas f1,fechas f2)
{
	bomba b;venta v;char fechaaux[10];fechas f3;int s=0;
	FILE *ptr=fopen("Bomba.dat","rb");
	fread(&b,sizeof(b),1,ptr);
	while(feof(ptr)==false)
	{
		if(b.idbomba==idbomba&&b.estado=='S')
		{
             FILE *ptr2=fopen("Ventas.dat","rb");
			 if(ptr!=NULL)
			 {
				 fread(&v,sizeof(v),1,ptr2);
				 while(feof(ptr)==false)
				 {
					 if(b.idbomba==v.idbomba&&v.estado=='S')
					 {   
						 strcpy(fechaaux,v.fecha);
						 quitarbarrasfecha(fechaaux);
						convertirfecha(f3,fechaaux);
						 if(((compararfechas(f1,f3)==0)||(compararfechas(f1,f3)==1))&&((compararfechas(f3,f2)==0)||(compararfechas(f3,f2)==1)))
						 {s=s+v.preciototal;}
					 }
					 fread(&v,sizeof(v),1,ptr2);
				 }
				 fclose(ptr2);
				 
			 }
			 else
			 { fclose(ptr);fclose(ptr2);
				 return 0;//retorno cero porque no hay registros de ventas entonces nadie compro nada
			 }
		}
	}fclose(ptr);return s;
}
void eliminarautomotoresporcliente(int x)
{FILE *ptr;
int y;
 automotor a;
 ptr=fopen("Automotor.dat","r+b");
 if(ptr!=NULL)
 {fread(&a,sizeof(a),1,ptr);
 while(feof(ptr)==false)
 {if(a.idcliente==x)
  {a.estado='N';
   
  }
 fread(&a,sizeof(a),1,ptr);
 }
 }
 else
 {cout<<"El archivo automotor no existe";
 }
 fclose(ptr);
}
